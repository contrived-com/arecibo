{
  "$schema": "https://claudia.contrived.com/schemas/prompt.schema.json",
  "id": "arecibo-api-first-bootstrap",
  "title": "Arecibo API-First Bootstrap",
  "description": "Implement Arecibo API handlers from the OpenAPI contract, wire schema validation, and validate GO_DARK control flow end-to-end.",
  "authors": [
    {
      "name": "Sean",
      "type": "human"
    },
    {
      "name": "gpt-5.3-codex",
      "type": "model"
    }
  ],
  "createdAt": "2026-02-26T08:43:58Z",
  "status": "ready",
  "tags": [
    "arecibo",
    "api-first",
    "embedded-transponder",
    "schemas",
    "go-dark",
    "observability"
  ],
  "content": "# Arecibo API-First Bootstrap\n\n## Context\n\nThis prompt assumes the implementing transponder has already read:\n- `AGENTS.md` in this repository\n- `~/dev/homelab-infra/ECOSYSTEM.md`\n\n## Goal\n\nImplement the first working Arecibo control-plane + ingest API from the existing API-first contract and schema set, then validate the transponder lifecycle including rare GO_DARK behavior.\n\nTreat `openapi.yml` as the source of truth and keep implementation behavior aligned with the contract.\n\n## Existing Contract Inputs\n\n- `openapi.yml`\n- `schemas/common/*.1.0.0.json`\n- `schemas/ingest/*.1.0.0.json`\n- `schemas/policy/*.1.0.0.json`\n- `schemas/api/result.1.0.0.json`\n\nExpected lifecycle:\n1. `POST /announce`\n2. `GET /policy`\n3. `POST /heartbeat` on policy cadence\n4. optional app datagrams -> transponder local socket\n5. `POST /events:batch` from transponder\n\n## Non-Negotiables\n\n1. OpenAPI-first discipline.\n2. RFC 3339 UTC timestamps with trailing `Z`.\n3. Use the term **primary application process (PID 1)**.\n4. GO_DARK means transponder stays alive and stable, keeps local behavior, and suppresses outbound sends.\n\n## Required API Behavior\n\n- Implement:\n  - `GET /health`\n  - `POST /announce`\n  - `GET /policy`\n  - `POST /heartbeat`\n  - `POST /events:batch`\n- API key auth via `X-API-Key` for non-health routes.\n- Request/response validation against repository schemas.\n- Structured JSON logging.\n\n## Policy And Session Model\n\n- `GET /policy` returns policy response including:\n  - `transponderSessionId`\n  - `fetchedAt`\n  - `ttlSec`\n  - `policy`\n- Validate `serviceName` + `environment`.\n- Return contract-compliant result on missing policy.\n\n## Directives\n\nSupport directive-bearing `result` envelopes:\n- `FLUSH_STATS`\n- `REFRESH_POLICY`\n- `GO_DARK`\n- `RESUME`\n- `SET_HEARTBEAT_INTERVAL`\n\n## Tests\n\nMinimum coverage:\n- Auth failures and success.\n- Schema validation failures (including non-`Z` timestamps).\n- Policy found and not-found paths.\n- Deterministic GO_DARK mode for heartbeat/events.\n\n## Acceptance Criteria\n\n1. All OpenAPI endpoints are implemented and routable.\n2. Auth enforced on all non-health endpoints.\n3. Requests and responses conform to JSON schemas.\n4. `GET /policy` returns valid policy response with `transponderSessionId`.\n5. `POST /heartbeat` and `POST /events:batch` can return directive-bearing `result` payloads.\n6. GO_DARK path is explicitly testable and covered.\n7. Local run + test instructions are documented and work.\n8. No secrets committed.\n"
}
